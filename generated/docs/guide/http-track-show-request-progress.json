{"id":"guide/http-track-show-request-progress","title":"HTTP - Track and show request progress","contents":"\n\n\n<div class=\"github-links\">\n  <a href=\"https://github.com/ng-docs/angular-cn/edit/cn/aio/content/guide/http-track-show-request-progress.md?message=docs%3A%20请简述你的修改...\" aria-label=\"提供编辑建议\" title=\"提供编辑建议\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n</div>\n\n\n<div class=\"content\">\n  <h1 id=\"http---track-and-show-request-progress\" translation-result=\"on\">HTTP - 跟踪和显示请求进度<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-track-show-request-progress#http---track-and-show-request-progress\"><i class=\"material-icons\">link</i></a></h1><h1 translation-origin=\"off\">HTTP - Track and show request progress<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-track-show-request-progress#http---track-and-show-request-progress\"><i class=\"material-icons\">link</i></a></h1>\n\n<p translation-result=\"on\">应用程序有时会传输大量数据，而这些传输可能要花很长时间。文件上传就是典型的例子。你可以通过提供关于此类传输的进度反馈，为用户提供更好的体验。</p><p translation-origin=\"off\">Sometimes applications transfer large amounts of data and those transfers can take a long time. File uploads are a typical example. You can give the users a better experience by providing feedback on the progress of such transfers.</p>\n\n<h2 id=\"make-a-request\" translation-result=\"on\">发出请求<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-track-show-request-progress#make-a-request\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">Make a request<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-track-show-request-progress#make-a-request\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">要想发出一个带有进度事件的请求，你可以创建一个 <code><a href=\"api/common/http/HttpRequest\" class=\"code-anchor\">HttpRequest</a></code> 实例，并把 <code>reportProgress</code> 选项设置为 true 来启用对进度事件的跟踪。</p><p translation-origin=\"off\">To make a request with progress events enabled, create an instance of <code><a href=\"api/common/http/HttpRequest\" class=\"code-anchor\">HttpRequest</a></code> with the <code>reportProgress</code> option set true to enable tracking of progress events.</p>\n\n<code-example header=\"app/uploader/uploader.service.ts (upload request)\" path=\"http/src/app/uploader/uploader.service.ts\" region=\"upload-request\">\nconst req = new <a href=\"api/common/http/HttpRequest\" class=\"code-anchor\">HttpRequest</a>('POST', '/upload/file', file, {\n  reportProgress: true\n});\n\n</code-example>\n<div class=\"alert is-important\">\n<p translation-result=\"on\"><strong>提示</strong>：<br>\n每个进度事件都会触发变更检测，所以只有当需要在 UI 上报告进度时，你才应该开启它们。</p><p translation-origin=\"off\"><strong>TIP</strong>: <br>\nEvery progress event triggers change detection, so only turn them on if you need to report progress in the UI.</p>\n\n<p translation-result=\"on\">当 <code><a href=\"api/common/http/HttpClient#request\" class=\"code-anchor\">HttpClient.request()</a></code> 和 HTTP 方法一起使用时，可以用 <code>observe: 'events'</code> 来查看所有事件，包括传输的进度。</p><p translation-origin=\"off\">When using <code><a href=\"api/common/http/HttpClient#request\" class=\"code-anchor\">HttpClient.request()</a></code> with an HTTP method, configure the method with <code>observe: 'events'</code> to see all events, including the progress of transfers.</p>\n\n</div>\n<h2 id=\"track-request-progress\" translation-result=\"on\">跟踪请求进度<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-track-show-request-progress#track-request-progress\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">Track request progress<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-track-show-request-progress#track-request-progress\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">接下来，将此请求对象传给 <code><a href=\"api/common/http/HttpClient#request\" class=\"code-anchor\">HttpClient.request()</a></code> 方法，该方法返回 <code>HttpEvents</code>（与<a href=\"guide/http-intercept-requests-and-responses#interceptor-events\">拦截器</a>处理的事件相同）的 <code>Observable</code>。</p><p translation-origin=\"off\">Next, pass this request object to the <code><a href=\"api/common/http/HttpClient#request\" class=\"code-anchor\">HttpClient.request()</a></code> method, which returns an <code>Observable</code> of <code>HttpEvents</code> (the same events processed by <a href=\"guide/http-intercept-requests-and-responses#interceptor-events\">interceptors</a>).</p>\n\n<code-example header=\"app/uploader/uploader.service.ts (upload body)\" path=\"http/src/app/uploader/uploader.service.ts\" region=\"upload-body\">\n// The `HttpClient.request` API produces a raw event stream\n// which includes start (sent), progress, and response events.\nreturn this.http.request(req).pipe(\n  map(event =&gt; this.getEventMessage(event, file)),\n  tap(message =&gt; this.showProgress(message)),\n  last(), // return last (completed) message to caller\n  catchError(this.handleError(file))\n);\n\n</code-example>\n<p translation-result=\"on\"><code>getEventMessage</code> 方法解释了事件流中每种类型的 <code><a href=\"api/common/http/HttpEvent\" class=\"code-anchor\">HttpEvent</a></code>。</p><p translation-origin=\"off\">The <code>getEventMessage</code> method interprets each type of <code><a href=\"api/common/http/HttpEvent\" class=\"code-anchor\">HttpEvent</a></code> in the event stream.</p>\n\n<code-example header=\"app/uploader/uploader.service.ts (getEventMessage)\" path=\"http/src/app/uploader/uploader.service.ts\" region=\"getEventMessage\">\n/** Return distinct message for sent, upload progress, &amp; response events */\nprivate getEventMessage(event: <a href=\"api/common/http/HttpEvent\" class=\"code-anchor\">HttpEvent</a>&lt;any&gt;, file: File) {\n  switch (event.type) {\n    case <a href=\"api/common/http/HttpEventType#Sent\" class=\"code-anchor\">HttpEventType.Sent</a>:\n      return `Uploading file \"${file.name}\" of size ${file.size}.`;\n\n    case <a href=\"api/common/http/HttpEventType#UploadProgress\" class=\"code-anchor\">HttpEventType.UploadProgress</a>:\n      // Compute and show the % done:\n      const percentDone = event.total ? Math.round(100 * event.loaded / event.total) : 0;\n      return `File \"${file.name}\" is ${percentDone}% uploaded.`;\n\n    case <a href=\"api/common/http/HttpEventType#Response\" class=\"code-anchor\">HttpEventType.Response</a>:\n      return `File \"${file.name}\" was completely uploaded!`;\n\n    default:\n      return `File \"${file.name}\" surprising upload event: ${event.type}.`;\n  }\n}\n\n</code-example>\n<div class=\"alert is-helpful\">\n<p translation-result=\"on\">本指南中的范例应用中没有用来接受上传文件的服务器。<code>app/http-interceptors/upload-interceptor.ts</code> 的 <code>UploadInterceptor</code> 通过返回一个模拟这些事件的可观察对象来拦截和短路上传请求。</p><p translation-origin=\"off\">The sample app for this guide doesn't have a server that accepts uploaded files.\nThe <code>UploadInterceptor</code> in <code>app/http-interceptors/upload-interceptor.ts</code> intercepts and short-circuits upload requests by returning an observable of simulated events.</p>\n\n</div>\n\n  <div class=\"reviewed\">最后复查时间：2/27/2023</div>\n</div>\n\n\n<!-- links to this doc:\n-->\n<!-- links from this doc:\n - api/common/http/HttpClient#request\n - api/common/http/HttpEvent\n - api/common/http/HttpEventType#Response\n - api/common/http/HttpEventType#Sent\n - api/common/http/HttpEventType#UploadProgress\n - api/common/http/HttpRequest\n - guide/http-intercept-requests-and-responses#interceptor-events\n - guide/http-track-show-request-progress#http---track-and-show-request-progress\n - guide/http-track-show-request-progress#http---跟踪和显示请求进度\n - guide/http-track-show-request-progress#make-a-request\n - guide/http-track-show-request-progress#track-request-progress\n - guide/http-track-show-request-progress#发出请求\n - guide/http-track-show-request-progress#跟踪请求进度\n - https://github.com/ng-docs/angular-cn/edit/cn/aio/content/guide/http-track-show-request-progress.md?message=docs%3A%20请简述你的修改...\n-->"}