{"id":"guide/http-handle-request-errors","title":"HTTP client - Handle request errors","contents":"\n\n\n<div class=\"github-links\">\n  <a href=\"https://github.com/ng-docs/angular-cn/edit/cn/aio/content/guide/http-handle-request-errors.md?message=docs%3A%20请简述你的修改...\" aria-label=\"提供编辑建议\" title=\"提供编辑建议\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n</div>\n\n\n<div class=\"content\">\n  <h1 id=\"http-client---handle-request-errors\" translation-result=\"on\">HTTP 客户端 - 处理请求错误<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-handle-request-errors#http-client---handle-request-errors\"><i class=\"material-icons\">link</i></a></h1><h1 translation-origin=\"off\">HTTP client - Handle request errors<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-handle-request-errors#http-client---handle-request-errors\"><i class=\"material-icons\">link</i></a></h1>\n\n<p translation-result=\"on\">如果请求在服务器上失败了，那么 <code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> 就会返回一个<em>错误</em>对象而不是一个成功的响应对象。</p><p translation-origin=\"off\">If the request fails on the server, <code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> returns an <em>error</em> object instead of a successful response.</p>\n\n<p translation-result=\"on\">执行服务器请求的同一个服务中也应该执行错误检查、解释和解析。</p><p translation-origin=\"off\">The same service that performs your server transactions should also perform error inspection, interpretation, and resolution.</p>\n\n<p translation-result=\"on\">发生错误时，你可以获得关于通知用户失败的详细信息。在某些情况下，你可能还会自动<a href=\"guide/http-handle-request-errors#retry\">重试请求</a>。</p><p translation-origin=\"off\">When an error occurs, you can obtain details of what failed to inform your user.\nIn some cases, you might also automatically <a href=\"guide/http-handle-request-errors#retry\">retry the request</a>.</p>\n\n<p><a id=\"error-details\"></a></p>\n<h2 id=\"getting-error-details\" translation-result=\"on\">获取错误详情<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-handle-request-errors#getting-error-details\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">Getting error details<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-handle-request-errors#getting-error-details\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">当数据访问失败时，应用会给用户提供有用的反馈。原始的错误对象作为反馈并不是特别有用。除了检测到错误已经发生之外，还需要获取错误详细信息并使用这些细节来撰写用户友好的响应。</p><p translation-origin=\"off\">An app should give the user useful feedback when data access fails.\nA raw error object is not particularly useful as feedback.\nIn addition to detecting that an error has occurred, you need to get error details and use those details to compose a user-friendly response.</p>\n\n<p translation-result=\"on\">可能会出现两种类型的错误。</p><p translation-origin=\"off\">Two types of errors can occur.</p>\n\n<ul>\n<li>\n<p translation-result=\"on\">服务端可能会拒绝该请求，并返回状态码为 404 或 500 的 HTTP <em>响应</em>对象。这些是错误<em>响应</em>。</p><p translation-origin=\"off\">The server backend might reject the request, returning an HTTP response with a status code such as 404 or 500.\nThese are error <em>responses</em>.</p>\n\n</li>\n<li>\n<p translation-result=\"on\">客户端也可能出现问题，比如网络错误会让请求无法成功完成，或者 RxJS 操作符也会抛出异常。这些错误的 <code>status</code> 为 <code>0</code>，并且其 <code>error</code> 属性包含一个 <code>ProgressEvent</code> 对象，此对象的 <code>type</code> 属性可以提供更详细的信息。</p><p translation-origin=\"off\">Something could go wrong on the client-side such as a network error that prevents the request from completing successfully or an exception thrown in an RxJS operator.\nThese errors have <code>status</code> set to <code>0</code> and the <code>error</code> property contains a <code>ProgressEvent</code> object, whose <code>type</code> might provide further information.</p>\n\n</li>\n</ul>\n<p translation-result=\"on\"><code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> 在其 <code><a href=\"api/common/http/HttpErrorResponse\" class=\"code-anchor\">HttpErrorResponse</a></code> 中会捕获两种错误。可以检查这个响应是否存在错误。</p><p translation-origin=\"off\"><code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> captures both kinds of errors in its <code><a href=\"api/common/http/HttpErrorResponse\" class=\"code-anchor\">HttpErrorResponse</a></code>.\nInspect that response to identify the error's cause.</p>\n\n<p translation-result=\"on\">以下示例在先前定义的 ConfigService 中定义了一个错误处理程序。</p><p translation-origin=\"off\">The following example defines an error handler in the previously defined ConfigService.</p>\n\n<code-example header=\"app/config/config.service.ts (handleError)\" path=\"http/src/app/config/config.service.ts\" region=\"handleError\">\nprivate handleError(error: <a href=\"api/common/http/HttpErrorResponse\" class=\"code-anchor\">HttpErrorResponse</a>) {\n  if (error.status === 0) {\n    // A client-side or network error occurred. Handle it accordingly.\n    console.error('An error occurred:', error.error);\n  } else {\n    // The backend returned an unsuccessful response code.\n    // The response body may contain clues as to what went wrong.\n    console.error(\n      `Backend returned code ${error.status}, body was: `, error.error);\n  }\n  // Return an observable with a user-facing error message.\n  return throwError(() =&gt; new Error('Something bad happened; please try again later.'));\n}\n\n</code-example>\n<p translation-result=\"on\">该处理程序会返回一个带有用户友好的错误信息的 RxJS <code>ErrorObservable</code>。下列代码修改了 <code>getConfig()</code> 方法，它使用一个<a href=\"guide/pipes\" title=\"管道指南\">管道</a>把 <code><a href=\"api/common/http/HttpClient#get\" class=\"code-anchor\">HttpClient.get()</a></code> 调用返回的所有 Observable 发送给错误处理器。</p><p translation-origin=\"off\">The handler returns an RxJS <code>ErrorObservable</code> with a user-friendly error message.\nThe following code updates the <code>getConfig()</code> method, using a <a href=\"guide/pipes\" title=\"Pipes guide\">pipe</a> to send all observables returned by the <code><a href=\"api/common/http/HttpClient#get\" class=\"code-anchor\">HttpClient.get()</a></code> call to the error handler.</p>\n\n<code-example header=\"app/config/config.service.ts (getConfig v.3 with error handler)\" path=\"http/src/app/config/config.service.ts\" region=\"getConfig_3\">\ngetConfig() {\n  return this.http.get&lt;Config&gt;(this.configUrl)\n    .pipe(\n      catchError(this.handleError)\n    );\n}\n\n</code-example>\n<p><a id=\"retry\"></a></p>\n<h2 id=\"retrying-a-failed-request\" translation-result=\"on\">重试失败的请求<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-handle-request-errors#retrying-a-failed-request\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">Retrying a failed request<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-handle-request-errors#retrying-a-failed-request\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">有时候，错误只是临时性的，只要重试就可能会自动消失。比如，在移动端场景中可能会遇到网络中断的情况，只要重试一下就能拿到正确的结果。</p><p translation-origin=\"off\">Sometimes the error is transient and goes away automatically if you try again.\nFor example, network interruptions are common in mobile scenarios, and trying again can produce a successful result.</p>\n\n<p translation-result=\"on\"><a href=\"guide/rx-library\">RxJS 库</a>提供了几个<em>重试</em>操作符。比如，<code>retry()</code> 操作符会自动重新订阅一个失败的 <code>Observable</code> 几次。<em>重新订阅</em> <code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> 方法会导致它重新发出 HTTP 请求。</p><p translation-origin=\"off\">The <a href=\"guide/rx-library\">RxJS library</a> offers several <em>retry</em> operators.\nFor example, the <code>retry()</code> operator automatically re-subscribes to a failed <code>Observable</code> a specified number of times.\n<em>Re-subscribing</em> to the result of an <code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> method call has the effect of reissuing the HTTP request.</p>\n\n<p translation-result=\"on\">下面的例子演示了如何在把一个失败的请求传给错误处理程序之前，先通过管道传给 <code>retry()</code> 操作符。</p><p translation-origin=\"off\">The following example shows how to pipe a failed request to the <code>retry()</code> operator before passing it to the error handler.</p>\n\n<code-example header=\"app/config/config.service.ts (getConfig with retry)\" path=\"http/src/app/config/config.service.ts\" region=\"getConfig\">\ngetConfig() {\n  return this.http.get&lt;Config&gt;(this.configUrl)\n    .pipe(\n      retry(3), // retry a failed request up to 3 times\n      catchError(this.handleError) // then handle the error\n    );\n}\n\n</code-example>\n<h2 id=\"sending-data-to-a-server\" translation-result=\"on\">把数据发送到服务器<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-handle-request-errors#sending-data-to-a-server\"><i class=\"material-icons\">link</i></a></h2><h2 translation-origin=\"off\">Sending data to a server<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/http-handle-request-errors#sending-data-to-a-server\"><i class=\"material-icons\">link</i></a></h2>\n\n<p translation-result=\"on\">除了从服务器获取数据外，<code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> 还支持其它一些 HTTP 方法，比如 PUT，POST 和 DELETE，你可以用它们来修改远程数据。</p><p translation-origin=\"off\">In addition to fetching data from a server, <code><a href=\"api/common/http/HttpClient\" class=\"code-anchor\">HttpClient</a></code> supports other HTTP methods such as PUT, POST, and DELETE, which you can use to modify the remote data.</p>\n\n<p translation-result=\"on\">本指南中的这个范例应用包括一个简略版本的《英雄之旅》，它会获取英雄数据，并允许用户添加、删除和修改它们。下面几节在 <code>HeroesService</code> 范例中展示了数据更新方法的一些例子。</p><p translation-origin=\"off\">The sample app for this guide includes an abridged version of the \"Tour of Heroes\" example that fetches heroes and enables users to add, delete, and update them.\nThe following sections show examples of the data-update methods from the sample's <code>HeroesService</code>.</p>\n\n\n  <div class=\"reviewed\">最后复查时间：2/27/2023</div>\n</div>\n\n\n<!-- links to this doc:\n - guide/http-send-data-to-server\n - guide/understanding-communicating-with-http\n-->\n<!-- links from this doc:\n - api/common/http/HttpClient\n - api/common/http/HttpClient#get\n - api/common/http/HttpErrorResponse\n - guide/http-handle-request-errors#getting-error-details\n - guide/http-handle-request-errors#http-client---handle-request-errors\n - guide/http-handle-request-errors#http-客户端---处理请求错误\n - guide/http-handle-request-errors#retry\n - guide/http-handle-request-errors#retrying-a-failed-request\n - guide/http-handle-request-errors#sending-data-to-a-server\n - guide/http-handle-request-errors#把数据发送到服务器\n - guide/http-handle-request-errors#获取错误详情\n - guide/http-handle-request-errors#重试失败的请求\n - guide/pipes\n - guide/rx-library\n - https://github.com/ng-docs/angular-cn/edit/cn/aio/content/guide/http-handle-request-errors.md?message=docs%3A%20请简述你的修改...\n-->"}